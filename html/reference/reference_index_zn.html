<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>title</title>
    <link rel="stylesheet" href="../../css/api.css">
    <script src="../../script/api.js"></script>
    <link rel="stylesheet" href="../../css/swiper.min.css"/>
    <script src="../../script/jquery.min.js"></script>
    <script src="../../script/rem.js"></script>
    <style>
    /*资料点击*/
        body,html{
            background: #f5f5f5;
        }
        .stock_box_zn{
            background: linear-gradient(to right, #268ce9,#64c0ea);
            height:.88rem;
            width:100%;
            position:fixed;
            top:0;
            left:0;
            overflow: hidden;
            z-index:10;
        }
        .stock_zn{
            color:#fff;
            font-size: .32rem;
            height:100%;
            line-height: .88rem;
            text-align: center;
        }
        .slider_box{
            height:2.8rem;
            margin-top:0.88rem;
        }
        .swiper-container{
            width:100%;
            height:2.8rem;
            position: relative;
        }
        .swiper-slide{
            background: #fff;
        }
        .swiper-slide img{
            width:100%;
            height:100%;
            background: url('../../image/loading_more.gif')no-repeat 50% 50%;
        }
        .swiper-pagination{
            position:absolute;
            bottom:0 !important;
            padding-bottom: 0.2rem
        }
        .swiper-pagination span{
            width:0.2rem;
            height:0.2rem;
            border-radius: 0.1rem;
            box-sizing: border-box;
            background: #268ce9;
            opacity: 1 !important;
        }
        .swiper-pagination-bullet-active{
            background: transparent !important;
            border:0.02rem solid #2348a4 !important;
            box-sizing: border-box;
        }
        .main_box_zn{
            margin-top:0.3rem;
            height:1.6rem;
            width:100%;
            box-sizing: border-box;
        }
        .main_list_zn{
            width:0.8rem;
            height:1.6rem;
            float: left;
            margin-left:0.4rem;
            margin-right:0.4rem;
            cursor:pointer
        }
        .main_list_zn img{
            width:0.8rem;
            height:0.8rem;
            display: block;
        }
        .main_list_zn p{
            height:0.7rem;
            width:0.8rem;
            box-sizing: border-box;
            text-align: center;
            line-height:0.7rem;
            color:#333;
            font-size:0.28rem;
        }
        .product_reference_zn{
            width:100%;
            height:5.4rem;
            background: #fff;
            overflow: hidden;
        }
        .product_title{
            height:0.9rem;
            line-height:0.9rem;
            width:100%;
            text-align: center;
            position: relative;
            cursor: pointer;
        }
        .product_title i{
            font-style: normal;
            font-size: 0.22rem;
            color: #868080;
            line-height: 0.7rem;
            position:absolute;
            top:0.1rem;
            right:6%;
        }
        .product_title span:first-child{
            width:0.22rem;
            height:0.27rem;
            display: block;
            background: url('../../image/image_zn/product_icon_title_zn.png');
            background-size:cover;
            position:absolute;
            top:0.31rem;
            left:40%;
        }
        .product_title span.title_{
            font-size:0.28rem;
            color:#999;
            height:0.9rem;
            line-height:0.9rem;
            position:absolute;
            left:45%;
        }
        .product_box_zn{
            width:100%;
            height:4.5rem;
            box-sizing: border-box;
            overflow: hidden;
        }
        .product_list_zn{
            width:2.9rem;
            height:2.25rem;
            margin-left:0.15rem;
            margin-right:0.15rem;
            float:left;
            /*padding:0.1rem;*/
            box-sizing: border-box;
            cursor:pointer
        }
        .product_list_zn img{
            width:2.9rem;
            height:1.6rem;
            display: block;
            background: #fff;
        }
        .product_list_zn p{
            height:0.65rem;
            line-height:0.65rem;
            font-size:0.22rem;
            color:#535353;
            text-align: center;
            width:100%;
        }
        .secrete_shop_zn{
            width:100%;
            height:auto;
            background: #fff;
            overflow: hidden;
            margin-top:0.3rem;
        }
        .product_title_secrete{
            height:0.9rem;
            line-height:0.9rem;
            width:100%;
            text-align: center;
            position: relative;
            cursor: pointer;
        }
        .product_title_secrete span:first-child{
            width:0.24rem;
            height:0.27rem;
            display: block;
            background: url('../../image/image_zn/secreate_titlte_zn.png');
            background-size:cover;
            position:absolute;
            top:0.31rem;
            left:40%;
        }
        .product_title_secrete span.title_{
            font-size:0.28rem;
            color:#999;
            height:0.9rem;
            line-height:0.9rem;
            position:absolute;
            left:45%;
        }
        .marketing_cheats_box{
            width:100%;
            height:auto;
            background: #fff;
            box-sizing: border-box;
            overflow: hidden;
        }
        .marketing_list_zn{
            width:6rem;
            height:1.27rem;
            padding:0.1rem;
            margin: 0 auto;
            /*box-sizing: border-box;*/
            margin-bottom:0.3rem;
            overflow: hidden;
            cursor:pointer
        }
        .marketing_img_zn{
            float:left;
            width:1.93rem;
            height:1.27rem;
            box-sizing: border-box;
        }
        .marketing_img_zn img{
            width:1.93rem;
            height:1.27rem;
            box-sizing: border-box;
        }
        .skill_box{
            float:left;
            margin-left:0.27rem;
            width:3.5rem;
            height:1.27rem;
            /*box-sizing: border-box;*/
        }
        .skill_title{
            height:0.24rem;
            line-height:0.26rem;
            font-size:0.24rem;
            width:100%;
            color:#525252;
            letter-spacing: 0.02rem;
        }
        .skill_con{
            width:100%;
            height:0.6rem;
            line-height:0.3rem;
            font-size:0.2rem;
            letter-spacing: 0.01rem;
            color:#999;
            margin-top:0.15rem;
        }
        .study_zn{
            width:100%;
            height:0.2rem;
            line-height:0.2rem;
            font-size:0.18rem;
            color:#b8b8b8;
            overflow: hidden;
            margin-top:0.07rem;
        }
        .health_example_zn{
            width:100%;
            height:auto;
            background: #fff;
            box-sizing: border-box;
            overflow: hidden;
            margin-top:0.3rem;
            margin-bottom:0.3rem;
        }
        .product_title_health{
            height:0.9rem;
            line-height:0.9rem;
            width:100%;
            text-align: center;
            position: relative;
            cursor:pointer;
        }
        .product_title_health span:first-child{
            width:0.27rem;
            height:0.27rem;
            display: block;
            background: url('../../image/image_zn/example_title_zn.png');
            background-size:cover;
            position:absolute;
            top:0.31rem;
            left:40%;
        }
        .product_title_health span.title_{
            font-size:0.28rem;
            color:#999;
            height:0.9rem;
            line-height:0.9rem;
            position:absolute;
            left:45%;
        }
        .study_zn span:last-child{
            float:right;
        }
        .mask{
            opacity: 0.9;
        }
        .product_title_secrete i{
            font-style: normal;
            font-size: 0.22rem;
            color: #868080;
            line-height: 0.7rem;
            position:absolute;
            top:0.1rem;
            right:6%;
        }
        .product_title_health i{
            font-style: normal;
            font-size: 0.22rem;
            color: #868080;
            line-height: 0.7rem;
            position:absolute;
            top:0.1rem;
            right:6%;
        }
    </style>
</head>
<body>
<div class="stock_box_zn">
    <div class="stock_zn">资料</div>
</div>
<div class="slider_box">
    <div class="swiper-container">
        <div class="swiper-wrapper">

        </div>
        <div class="swiper-pagination"></div>
    </div>
</div>
<ul class="main_box_zn">
    <li class="main_list_zn" onclick="open_Jump(1)">
        <img src="../../image/image_zn/main_list_01zn.png" alt=""/>
        <p>产品</p>
    </li>
    <li class="main_list_zn" onclick="open_Jump(2)">
        <img src="../../image/image_zn/main_list_02zn.png" alt=""/>
        <p>秘籍</p>
    </li>
    <li class="main_list_zn" onclick="open_Jump(3)">
        <img src="../../image/image_zn/main_list_03zn.png" alt=""/>
        <p>案例</p>
    </li>
    <li class="main_list_zn" onclick="open_Jump(4)">
        <img src="../../image/image_zn/main_list_04zn.png" alt=""/>
        <p>下载</p>
    </li>
</ul>
<!--产品资料start -->
<div class="product_reference_zn">
    <p class="product_title" onclick="open_Jump(1)" >
        <span></span>
        <span class="title_">产品资料</span>
        <i>更多</i>
    </p>
    <ul class="product_box_zn">
      <li class="product_list_zn" >
        <div style="width:2.9rem;height:1.6rem;background:#F5F5F5;border-radius:0.1rem;margin-bottom:0.1rem"></div>
        <p style="height:0.2rem;line-height:0.3rem;background:#F5F5F5;border-radius:0.1rem;margin:auto"></p>
      </li>
      <li class="product_list_zn" >
        <div style="width:2.9rem;height:1.6rem;background:#F5F5F5;border-radius:0.1rem;margin-bottom:0.1rem"></div>
        <p style="height:0.2rem;line-height:0.3rem;background:#F5F5F5;border-radius:0.1rem;margin:auto"></p>
      </li>
      <li class="product_list_zn" >
        <div style="width:2.9rem;height:1.6rem;background:#F5F5F5;border-radius:0.1rem;margin-bottom:0.1rem"></div>
        <p style="height:0.2rem;line-height:0.3rem;background:#F5F5F5;border-radius:0.1rem;margin:auto"></p>
      </li>
      <li class="product_list_zn" >
        <div style="width:2.9rem;height:1.6rem;background:#F5F5F5;border-radius:0.1rem;margin-bottom:0.1rem"></div>
        <p style="height:0.2rem;line-height:0.3rem;background:#F5F5F5;border-radius:0.1rem;margin:auto"></p>
      </li>
    </ul>
</div>
<!-- 产品资料end-->
<!--营销秘籍start -->
<div class="secrete_shop_zn">
    <p class="product_title_secrete" onclick="open_Jump(2)">
        <span></span>
        <span class="title_">营销秘籍</span>
        <i>更多</i>
    </p>
    <ul class="marketing_cheats_box">
    </ul>
</div>
<!-- 营销秘籍end-->
<!-- 康复案例start-->
<div class="health_example_zn">
    <p class="product_title_health" onclick="open_Jump(3)">
        <span></span>
        <span class="title_">康复案例</span>
        <i>更多</i>
    </p>
    <ul class="marketing_cheats_box_cass">
    </ul>
</div>
<!-- 康复案例end-->
<script type="text/javascript" src="../../script/api.js"></script>
<script src="../../script/imagescache.js"></script>
<script src="../../script/swiper.min.js"></script>
<script>
    var videotype;
    ///跳转事件根据flag判断跳转到哪
    function open_Jump(flag){
      var name;//win name
      var url;//win本地路径
      switch (flag) {
        case 1://产品列表
            name='product_list_zn';
            url="widget://html/reference/product_list_zn.html"
          break;
        case 2://销售秘籍列表
            name='Marketing_cheats_zn';
            url="widget://html/reference/Marketing_cheats_zn.html"
          break;
        case 3://康复案例列表
            name='anli_list';
            url="widget://html/reference/anli_list.html"
          break;
        case 4://下载列表
            name='download_zn';
            url="widget://html/reference/download_zn.html"
          break;
        default:
      }
      api.openWin({
          name: name,
          url: url,
          rect: {x: 0, y: 0, w: 'auto', h: 'auto'},
          animation:{
            type:"none",                //动画类型（详见动画类型常量）
            duration:50
          }
      });
    }
    function get_data() {
            var product_list;//产品数组
            var mark_list;//营销秘籍数组
            var case_list;//康复案例数组
            product_list=$api.getStorage('product_list');
            mark_list=$api.getStorage('mark_list');
            case_list=$api.getStorage('case_list');
            r_banner_list=$api.getStorage('r_banner_list');
            if(product_list&&mark_list&&case_list&&r_banner_list){//判断本地是否有存储的数据
              $(".product_box_zn").html(product_list);
              $(".marketing_cheats_box").html(mark_list);
              $('.marketing_cheats_box_cass').html(case_list);
              $('.swiper-wrapper').html(r_banner_list);
              var swiper=new Swiper('.swiper-container',{
                  pagination:'.swiper-pagination',
                  slidersPerView:1,
                  paginationClickable:true,
                  loop:true,
                  autoplay:3000,
                  autoplayDisableOnInteraction:false
              })
            }else{
              api.ajax({
                  url: 'http://appapi.duyiwang.cn/index.php?action=ziliao&dir=ziliao&do=index1',
                  method: 'post',
                  dataType: 'json'
              }, function (ret, err) {
                  if(ret.pArr){//获取产品数组
                    var html=split_html(1,ret.pArr);
                    $api.setStorage('product_list', html);
                    $(".product_box_zn").html(html);
                  }
                  if(ret.mArr){//获取营销秘籍
                    var html=split_html(2,ret.mArr);
                    $api.setStorage('mark_list', html);
                    $(".marketing_cheats_box").html(html);
                  }
                  if(ret.cArr){//获取康复案列
                    var html=split_html(3,ret.cArr);
                    $api.setStorage('case_list', html);
                    $('.marketing_cheats_box_cass').html(html);
                  }
              });
              get_image_zn();
            }
        api.refreshHeaderLoadDone();
    }
    //获取资料页banner
    function get_image_zn(){
        var type=2;
        api.ajax({
            url: 'http://appapi.duyiwang.cn/index.php?action=banner&dir=work&do=banner',
            method: 'post',
            data: {
                values: {type:type}
            },
            dataType: 'json'
        }, function (ret, err) {
            var html=split_html(4,ret.banner.img);
            $api.setStorage('r_banner_list',html);
            $('.swiper-wrapper').html(html);
            var swiper=new Swiper('.swiper-container',{
                pagination:'.swiper-pagination',
                slidersPerView:1,
                paginationClickable:true,
                loop:true,
                autoplay:3000,
                autoplayDisableOnInteraction:false
            })
        });
    }
    //组合页面
    function split_html(style,object){
      var html="";
      switch (style) {
        case 1://产品列表页面
          $.each(object,function(i,v){
              html+='<li class="product_list_zn" gid="'+v.id+'">'+
                  '<img src="http://app.duyiwang.cn'+v.good_img+'" alt="" onload="fnLoadImage(this)" data-url="http://app.duyiwang.cn'+v.good_img+'"/>'+
                  '<p>独一张·'+v.name+'</p></li>'

          });
          break;
        case 2://秘籍页面
          $.each(object,function(i,v){
              html+='<li class="marketing_list_zn" vid="'+v.id+'" videotype="'+v.type+'" >'+
                  '<p class="marketing_img_zn">'+
                      '<img src="http://app.duyiwang.cn'+v.video_img+'" alt="" onload="fnLoadImage(this)" date-url="http://app.duyiwang.cn'+v.video_img+'"/></p>'+
                  '<div class="skill_box">'+
                      '<p class="skill_title">'+v.name.substr(0,10)+'</p>'+
                      '<p class="skill_con">'+ v.content.substr(0,30)+'</p>'+
                      '<p class="study_zn">'+
                          '<span>'+v.kcnum.kcnum+'门课/'+v.learnnum.learnnum+'人学习</span>'+
                      '</p>  </div>'+
              '</li>';

          });
          break;
        case 3:
          $.each(object,function(i,v){
              html+='<li class="marketing_list_zn" cid="'+v.id+'">'+
                  '<p class="marketing_img_zn">'+
                      '<img src="http://app.duyiwang.cn/img/'+v.img+'" alt="" onload="fnLoadImage(this)" date-url="http://app.duyiwang.cn/img/'+v.img+'"/>'+
                  '</p>'+
                  '<div class="skill_box">'+
                      '<p class="skill_title">来自：'+v.mname.substr(0,10)+'</p>'+
                      '<p class="skill_con">'+v.content.substr(0,30)+'</p>'+
                      '<p class="study_zn">'+
                          '<span>产品：独一张·'+v.gname.substr(0,10)+'</span>'+
                          '<span>'+v.addtime+'</span></p>  </div></li>';

          });
          break;
        case 4://banner
          $.each(object ,function(i,v){
            html+="<div class='swiper-slide'><img onload='fnLoadImage(this)' data-url='http://app.duyiwang.cn/img/"+v+"' src='http://app.duyiwang.cn/img/"+v+"' alt=''></div>";
          });
          break;
      }
      return html;
    }
    // 下拉刷新
    function initRefresh(){
        api.setRefreshHeaderInfo({
             //loadingImg: './../image/refresh.png',
            bgColor: '#fff',
            textColor: '#64c0ea',
            textDown: '下拉刷新...',
            textUp: '松开刷新...',
            textLoading:'高速加载中...'
        }, function(ret, err) {
            $api.rmStorage('product_list');
            $api.rmStorage('mark_list');
            $api.rmStorage('case_list');
            $api.rmStorage('r_banner_list');
            get_data();
            //在这里从服务器加载数据，加载完成后调用api.refreshHeaderLoadDone()方法恢复组件到默认状态
        });
    }
    apiready=function(){
        get_data();
        initRefresh();
    }

    $(document).on('click','.product_list_zn',function(){
//        $(this).css('background','#eee');
        var gid=$(this).attr('gid');
        api.openWin({
            name: 'product_detail_zn',
            pageParam: {
                gid: gid
            },
            url: 'widget://html/reference/product_detail_zn.html',
            rect: {x: 0, y: 0, w: 'auto', h: 'auto'}
        });
    })


    $(document).on('click','.secrete_shop_zn .marketing_list_zn',function(){
//        $(this).css('background','#eee');
        var vid=$(this).attr('vid');
        videotype=parseInt($(this).attr('videotype'));
        if(videotype===0){
            api.openWin({
                name: 'manager_training_zn',
                pageParam: {
                    vid:vid,
                    type:videotype
                },
                url: 'widget://html/reference/manager_training_zn.html',
                rect: {x: 0, y: 0, w: 'auto', h: 'auto'}
            });
        }else{
            api.openWin({
                name: 'miji_fenlei_yyt',
                pageParam: {
                    vid:vid,
                    type:videotype
                },
                url: 'widget://html/reference/miji_fenlei_yyt.html',
                rect: {x: 0, y: 0, w: 'auto', h: 'auto'}
            });
        }
    })
    $(document).on('click','.health_example_zn .marketing_list_zn',function(){
//        $(this).css('background','#eee');
        var cid=$(this).attr('cid');
        api.openWin({
            name: 'anli_detail',
            pageParam: {
                cid: cid
            },
            url: 'widget://html/reference/anli_detail.html',
            rect: {x: 0, y: 0, w: 'auto', h: 'auto'}
        });
    })
    $(document).on('touchstart','.product_list_zn',function(){
        $(this).css('background','#eee');
        $(this).on('touchend',function(){
            $(this).css('background','#fff');
        })
    })
    $(document).on('touchstart','.secrete_shop_zn .marketing_list_zn',function(){
        $(this).css('background','#eee');
        $(this).on('touchend',function(){
            $(this).css('background','#fff');
        })
    })
    $(document).on('touchstart','.health_example_zn .marketing_list_zn',function(){
        $(this).css('background','#eee');
        $(this).on('touchend',function(){
            $(this).css('background','#fff');
        })
    })
    var startPos = 0,endPos = 0,isScrolling = 0;
    document.addEventListener('touchstart',function(event){
        var touch = event.targetTouches[0]; //touches数组对象获得屏幕上所有的touch，取第一个touch
        startPos = {x:touch.pageX,y:touch.pageY,time:+new Date}; //取第一个touch的坐标值
        isScrolling = 0; //这个参数判断是垂直滚动还是水平滚动
    }, false);

    //解绑事件 web前端开发
    document.addEventListener('touchend',function(event){
        document.removeEventListener('touchmove',this,false);
        document.removeEventListener('touchend',this,false);
    }, false);

    document.addEventListener('touchmove',function(event){
        //当屏幕有多个touch或者页面被缩放过，就不执行move操作
        if(event.targetTouches.length > 1 || event.scale && event.scale !== 1) return;
        var touch = event.targetTouches[0];
        endPos = {x:touch.pageX - startPos.x,y:touch.pageY - startPos.y};
        isScrolling = Math.abs(endPos.x) < Math.abs(endPos.y) ? 1:0; //isScrolling为1时，表示纵向滑动，0为横向滑动
        if(isScrolling === 0){

            event.preventDefault(); //阻止触摸事件的默认行为，即阻止滚屏
        }
    }, false);
</script>
</body>
</html>
